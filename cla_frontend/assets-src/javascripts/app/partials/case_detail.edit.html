<header class="PageHeader cf">
  <h1>{{ pageTitle || 'Case details' }}</h1>
</header>

<div ui-view="notes">
  <form method="post" ng-submit="save()" name="form">
    <div class="FormRow cf">
      <label for="id_case_notes-notes" id="id_case_notes-notes-label" class="visuallyhidden">Case Notes</label>
      <span class="Error-message" ng-show="form.notes.$error.server">{{ errors.notes }}</span>
      <textarea class="FormRow-field--full" id="id_case_notes-notes" name="notes" placeholder="Comments about this case" cols="20" rows="11" ng-model="case.notes" server-error></textarea>
    </div>

    <div class="FormRow">
      <label for="id_case_notes-in_scope" id="id_case_notes-in_scope-label">
        <span class="FormRow-label">In Scope</span>

        <select id="id_case_notes-in_scope" name="case_notes-in_scope" ng-model="case.in_scope" ng-options="choice.value as choice.label for choice in in_scope_choices">
        </select>
      </label>
    </div>

    <div class="FormActions">
      <button type="submit" class="Button">Save case details</button>
    </div>
  </form>
</div>

<hr class="u-horLine">

<div ui-view="">
  <div ng-controller="DiagnosisSummaryCtrl">
    <div ng-include="'includes/diagnosis.summary.html'"></div>

    <div class="FormActions">
      <button type="submit" class="Button" ui-sref="case_detail.edit.diagnosis" ng-show="!case.diagnosis || case.diagnosis && diagnosis.isInScopeUnknown()">{{ !case.diagnosis ? 'New' : 'Complete' }} scope diagnosis</button>
      <button type="submit" class="Button" ng-click="delete()" ng-show="case.diagnosis">Delete scope diagnosis</button>
    </div>
  </div>

  <hr class="u-horLine">

  <div ng-controller="EligibilityCheckSummaryCtrl">
    <h2 ng-class="eligibilityTitleClass()">{{ eligibilityTitle() }}</h2>

    <div ng-show="case.eligibility_check">
      <div ng-show="!eligibility_check.isEligibilityUnknown()">
        <section class="SummaryBlock CommentBlock" ng-show="eligibility_check.notes">
          <figure class="SummaryBlock-content">
            <div class="Icon Icon--row Icon--user">
              <figcaption>{{ case.created | general_date }} - {{ personal_details.full_name }} wrote:</figcaption>
              <blockquote class="Quote">{{ eligibility_check.notes }}</blockquote>
            </div>
          </figure>
        </section>

        <section class="SummaryBlock Grid" ng-repeat="section in means_summary">
          <div class="Grid-row">
            <div class="SummaryBlock-content cf">
              <a ui-sref="case_detail.edit.eligibility({section:section.step})" class="Icon Icon--abs-r Icon--edit"></a>

              <h2 class="SummaryBlock-heading Grid-col Grid-col--1-3">{{ section.header }}</h2>
            
              <ul class="Grid-col Grid-col--2-3">
                <li ng-repeat="item in section.items"><span ng-bind-html="item"></span></li>
              </ul>
            </div>
          </div>
        </section>
      </div>

      <div ng-show="eligibility_check.isEligibilityUnknown()">
        <p>Incomplete means test</p>
        <button type="submit" class="Button" ui-sref="case_detail.edit.eligibility">Complete means test</button>
      </div>
    </div>

    <div class="FormActions" ng-show="!case.eligibility_check">
      <button type="submit" class="Button" ui-sref="case_detail.edit.eligibility">New means test</button>
    </div>
  </div>
</div>
