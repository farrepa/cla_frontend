<header class="PageHeader cf">
  <div ng-switch on="user.is_manager">
    <div ng-switch-when="true">
      <h1 data-block="title">Cases</h1>
    </div>
    <h1 ng-switch-default>Cases</h1>
  </div>

  <div data-block="top-actions"></div>

  <nav class="Filters">
    <a class="Label is-selected is-removable" ng-if="searchParams.search" ng-click="resetSearch()">"{{ searchParams.search }}"</a>
    <span data-block="filters"></span>
  </nav>
</header>

<div class="Notice" ng-if="historicCases.count > 0">there are {{ historicCases.count }} historic cases (from capita's system) that match your search <a href="" ui-sref="historic_list({search: searchParams.search})">view them?</a></div>
<table class="ListTable" cellpadding="0" cellspacing="0" border="0" width="100%">
  <thead>
    <tr>
      <th width="2%"></th>
      <th width="18%"><span class="visuallyhidden">Case Reference</span></th>
      <th width="20%"><a href="" ng-click="sortToggle('personal_details__full_name')" ng-class="sortClass('personal_details__full_name')">Name</a></th>
      <th width="10%"><a href="" ng-click="sortToggle('personal_details__postcode')" ng-class="sortClass('personal_details__postcode')">Postcode</a></th>
      <th width="10%"><a href="" ng-click="sortToggle('personal_details__date_of_birth')" ng-class="sortClass('personal_details__date_of_birth')">Date of Birth</a></th>
      <th width="20%"><a href="" ng-click="sortToggle('eligibility_check__category__name')" ng-class="sortClass('eligibility_check__category__name')">Area of Law</a></th>
      <th width="10%"><a href="" ng-click="sortToggle('modified')" ng-class="sortClass('modified')">Modified</a></th>
      <th width="10%"><span data-block="outcome-column"><a href="" ng-click="sortToggle('priority')" ng-class="sortClass('priority')">Priority</a></span></th>
    </tr>
  </thead>
  <tbody>
    <tr dir-paginate="case in cases.results | itemsPerPage: 20"
      total-items="cases.count" current-page="searchParams.page"
      ng-class="{'is-rejected': case.rejected, 'is-new': !case.provider_viewed && case.provider_viewed !== undefined, 'is-complete': case.outcome_code == 'SPOP'}">
      <td></td>
      <td>
        <a href="" ng-click="goToCase(case.reference)">{{ ::case.reference }}</a>
        <span ng-if="case.isInScopeAndEligible()"> / {{ ::case.laa_reference }}</span>
      </td>
      <td>
        <span data-block="pd-column">{{ ::case.full_name }}</span>
      </td>
      <td>{{ ::case.postcode }}</td>
      <td>{{ ::case.date_of_birth|date:'dd/MM/yyyy' }}</td>
      <td>{{ ::case.category }}</td>
      <td>
        <timestamp ng-model="case.modified"></timestamp>
      </td>
      <td><span class="Label Label--secondary" ng-if="case.outcome_code">{{ ::case.outcome_code }}</span></td>
    </tr>
  </tbody>
</table>

<dir-pagination-controls on-page-change="pageChanged(newPageNumber)" data-boundary-links="true"></dir-pagination-controls>
